<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>随机号数抽取</title>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<style>
body {
	background-color:aliceblue;
}
.wrapDiv {
	width:80%;
	max-width:1200px;
	margin:0 auto;
	text-align:center;
	position:absolute;
	top:80px;
	left:10px;
	right:0;
}
.leftBox {
	float:left;
	width:600px;
	height:450px;
	/*background-color:aqua;
	*/
    	margin:0 auto;
	margin-top:0px;
	clear:both;
}
#span {
	float:right;
	top:10px;
	right:185px;
}
#btn {
	float:left;
	width:100px;
	height:30px;
	margin-left:10px;
	margin-top:70px;
}
.nameBox {
	width:100px;
	height:30px;
	float:left;
	background-color:antiquewhite;
	margin-left:10px;
	margin-top:10px;
	text-align:center;
	line-height:30px;
}
.selectedName {
	float:right;
	width:340px;
	background:#666;
	margin-top:10px;
	margin-left:30px;
	background:#ffffff;
	overflow:hidden;
}
h1 {
	text-align:center;
}
</style>
</head>
<body>
<h1>随机号数抽取V4</h1>
<span id="span"></span>

<div class="wrapDiv">
    <div id="leftBox" class="leftBox"></div>
    <div id="selectedName" class="selectedName">
        <h1>中奖者名单</h1>
    </div>

    <input type="button" id="btn" value="走起！">
</div>

<script>
var MAX_NUMBER = 42;
var EXCLUDED_NUMBERS = []; // 需要排除的数字
var fullNumbers = []; // 用于展示的完整数字列表
var drawNumbers = []; // 实际参与抽取的数字列表

// 初始化数字列表
for (var i = 1; i <= MAX_NUMBER; i++) {
    fullNumbers.push(i.toString().padStart(2, '0'));
}
drawNumbers = fullNumbers.filter(num => !EXCLUDED_NUMBERS.includes(parseInt(num)));

var orgArrCount = fullNumbers.length;
var currentSelectNum = -1; // 初始化当前选中数字索引

initForm();

function initForm() {
    // 动态设置选择人的高度和创建展示层
    $("#selectedName").css("height", orgArrCount / 3 * 40 + 120 + "px");
    dynamicCreateBox(fullNumbers);
}

function dynamicCreateBox(numbers) {
    numbers.forEach(function(number) {
        var div = $("<div>").text(number).addClass("nameBox");
        $("#leftBox").append(div);
    });
}

function clearBoxColor() {
    $("#leftBox .nameBox").css("background-color", "");
}

function setBoxColor(index) {
    $("#leftBox .nameBox").eq(index).css("background-color", "skyblue");
}

function appendSelectedName(number) {
    $("<div>").text(number).addClass("nameBox").appendTo($("#selectedName"));
}

var timeId;

$('#btn').click(function() {
    var remainingCount = drawNumbers.length;
    if (remainingCount < 1) {
        alert("所有有效的数字都已经抽取完毕，请刷新页面重置。");
        clearBoxColor();
        return;
    }
    
    if (this.value === "走起！") {
    	timeId = setInterval(function() {
        		clearBoxColor();
        		var selected = drawNumbers[Math.floor(Math.random() * remainingCount)];
        		currentSelectNum = fullNumbers.indexOf(selected); // 记录当前选中数字在fullNumbers中的索引
        		setBoxColor(currentSelectNum);
   	 }, 10); // 放慢速度以便观察
    	this.value = "停！";
    } else {
    	clearInterval(timeId);
    	// 确保添加到中奖名单的数字与当前高亮显示的数字相对应
    	var selectedNumberForDisplay = fullNumbers[currentSelectNum];
    	appendSelectedName(selectedNumberForDisplay);

    	// 从drawNumbers中找到并移除已经选择的数字
    	var indexToRemove = drawNumbers.indexOf(selectedNumberForDisplay);
    	if (indexToRemove > -1) { // 确保找到该数字
        	drawNumbers.splice(indexToRemove, 1); // 移除找到的数字
    	}

    	this.value = "走起！";
    }
});
</script>

</body>
</html>

